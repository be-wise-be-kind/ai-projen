# Purpose: Define file placement rules for ai-projen repository
# Scope: All project files, enforcing organization standards
# Overview: Establishes authoritative rules for where different types of files should be placed
#     throughout the ai-projen repository. Provides guidance for AI agents and validation rules
#     for maintaining consistent project organization.

version: "1.0"
_meta:
  description: "File placement rules for ai-projen repository"
  schema_version: "1.0"
  last_updated: "2025-10-01"

ai_guidance:
  description: "Human-readable guidance for AI agents on file placement"
  principles:
    plugin_organization: "All plugins in plugins/ with category subdirectories"
    documentation_separation: "Project docs in .ai/docs/, plugin docs in plugin directories"
    template_isolation: "Templates in .ai/templates/ and plugin-specific templates/ directories"
    orchestrator_root: "Orchestrators (CREATE/UPGRADE/ADD) at repository root"

  decision_trees:
    plugin_placement:
      question: "Where should this plugin go?"
      criteria:
        is_universal: "→ plugins/foundation/"
        is_language: "→ plugins/languages/{language}/"
        is_containerization: "→ plugins/infrastructure/containerization/{tool}/"
        is_cicd: "→ plugins/infrastructure/ci-cd/{platform}/"
        is_iac: "→ plugins/infrastructure/iac/{tool}/"
        is_standard: "→ plugins/standards/{standard}/"

    documentation_placement:
      question: "Where should this documentation go?"
      criteria:
        is_howto_guide: "→ .ai/howto/ (step-by-step procedural guides starting with 'how-to-')"
        is_conceptual_doc: "→ .ai/docs/ (architecture, standards, philosophy, specifications)"
        is_plugin_specific: "→ plugins/{category}/{name}/README.md"
        is_roadmap: "→ roadmap/{feature}/"

      examples:
        howto_folder:
          - "how-to-create-new-ai-repo.md (step-by-step workflow)"
          - "how-to-create-a-language-plugin.md (procedural guide)"
          - "how-to-upgrade-to-ai-repo.md (action-oriented steps)"
        docs_folder:
          - "PROJECT_CONTEXT.md (architectural overview)"
          - "PLUGIN_ARCHITECTURE.md (system specification)"
          - "FILE_HEADER_STANDARDS.md (requirements and rules)"
          - "HOWTO_STANDARDS.md (meta-documentation about how-tos)"

    template_placement:
      question: "Where should this template go?"
      criteria:
        is_universal_template: "→ .ai/templates/"
        is_plugin_template: "→ plugins/{category}/{name}/templates/"
        is_category_template: "→ plugins/{category}/_template/"

  common_mistakes:
    plugins_in_wrong_category: "Don't put language plugins in infrastructure/"
    docs_in_plugin_root: "Don't put project docs in plugin directories"
    templates_scattered: "Don't scatter templates - use templates/ directories"
    orchestrators_in_plugins: "Don't put CREATE/UPGRADE/ADD in plugins/"
    howtos_in_docs: "Don't put how-to guides in .ai/docs/ - they belong in .ai/howto/"
    docs_in_howtos: "Don't put conceptual/architectural docs in .ai/howto/ - they belong in .ai/docs/"

  template_structure:
    universal_templates:
      location: ".ai/templates/"
      purpose: "Project-wide templates available to all plugins and projects"
      naming: "*.{ext}.template (e.g., component.tsx.template, module.py.template)"
      files:
        - HOW_TO_TEMPLATE.md (template for creating how-to guides)
        - TEMPLATE_FILE_TEMPLATE.md (meta-template for creating templates)
        - roadmap-progress-tracker.md.template (roadmap progress tracking)
        - roadmap-pr-breakdown.md.template (feature breakdown into PRs)
        - roadmap-ai-context.md.template (comprehensive feature context)

    plugin_templates:
      foundation:
        location: "plugins/foundation/ai-folder/ai-content/templates/"
        files:
          - AGENTS.md.template (AI agent entry point)
          - index.yaml.template (navigation index)
          - layout.yaml.template (directory layout)

      languages:
        location: "plugins/languages/{language}/templates/"
        pattern: "Language-specific code templates"
        examples:
          - "plugins/languages/python/templates/module.py.template"
          - "plugins/languages/typescript/templates/component.tsx.template"

      infrastructure:
        location: "plugins/infrastructure/{category}/{tool}/templates/"
        pattern: "Infrastructure configuration templates"
        examples:
          - "plugins/infrastructure/containerization/docker/templates/dockerfile.template"
          - "plugins/infrastructure/ci-cd/github-actions/templates/workflow.yaml.template"

      standards:
        location: "plugins/standards/{standard}/templates/"
        pattern: "Standards configuration and documentation templates"

    template_naming:
      extension: ".template (always add to end of filename)"
      format: "{name}.{target-ext}.template"
      examples:
        - "user-service.py.template → generates user-service.py"
        - "api-config.yaml.template → generates api-config.yaml"
        - "component.tsx.template → generates component.tsx"

    template_standards:
      header_requirements: ".ai/docs/FILE_HEADER_STANDARDS.md (Template Files section)"
      creation_guide: ".ai/howto/how-to-create-a-template.md"
      meta_template_reference: ".ai/templates/TEMPLATE_FILE_TEMPLATE.md"

    placeholder_conventions:
      snake_case: "{{VARIABLE_NAME}} - for file/module/variable names"
      PascalCase: "{{ClassName}} - for class/component/type names"
      camelCase: "{{functionName}} - for function/method/property names"
      SCREAMING_SNAKE: "{{CONSTANT_NAME}} - for constants/environment variables"
      kebab-case: "{{file-name}} - for URLs/CSS classes/file paths"

linter_rules:
  description: "Machine-readable rules for file placement validation"

  paths:
    .:
      description: "Root directory"
      allow:
        - '^README\.md$'
        - '^LICENSE$'
        - '^\.gitignore$'
        - '^\.env$'
        - '^CREATE-NEW-AI-REPO\.md$'
        - '^UPGRADE-TO-AI-REPO\.md$'
        - '^ADD-CAPABILITY\.md$'
        - '^CONTRIBUTING\.md$'
      deny:
        - '^\.(py|js|ts)$'
        - '^test.*\.md$'
        - '^debug.*'

    .ai/:
      description: "AI navigation and documentation"
      allow:
        - '^\.ai/index\.yaml$'
        - '^\.ai/layout\.yaml$'
        - '^\.ai/docs/.*\.md$'
        - '^\.ai/howto/.*\.md$'
        - '^\.ai/templates/.*\.(template|md)$'
      deny:
        - '\.py$'
        - '\.js$'
        - '\.ts$'
        - 'test'

    plugins/:
      description: "Plugin library"
      allow:
        - '^plugins/PLUGIN_MANIFEST\.yaml$'
        - '^plugins/foundation/.*/AGENT_INSTRUCTIONS\.md$'
        - '^plugins/foundation/.*/README\.md$'
        - '^plugins/foundation/.*/template/.*$'
        - '^plugins/languages/.*/AGENT_INSTRUCTIONS\.md$'
        - '^plugins/languages/.*/README\.md$'
        - '^plugins/languages/.*/templates/.*$'
        - '^plugins/languages/.*/configs/.*$'
        - '^plugins/languages/_template/.*$'
        - '^plugins/infrastructure/.*/AGENT_INSTRUCTIONS\.md$'
        - '^plugins/infrastructure/.*/README\.md$'
        - '^plugins/infrastructure/.*/templates/.*$'
        - '^plugins/infrastructure/.*/_template/.*$'
        - '^plugins/standards/.*/AGENT_INSTRUCTIONS\.md$'
        - '^plugins/standards/.*/README\.md$'
        - '^plugins/standards/.*/templates/.*$'
        - '^plugins/standards/.*/docs/.*\.md$'
        - '^plugins/standards/_template/.*$'
      deny:
        - '^plugins/[^/]+\.py$'
        - '^plugins/[^/]+\.js$'
        - 'test_'
        - '_test\.'

    roadmap/:
      description: "Implementation roadmaps"
      allow:
        - '^roadmap/ROADMAP\.md$'
        - '^roadmap/[^/]+/PROGRESS_TRACKER\.md$'
        - '^roadmap/[^/]+/AI_CONTEXT\.md$'
        - '^roadmap/[^/]+/PR_BREAKDOWN\.md$'
        - '^roadmap/[^/]+/.*\.md$'
      deny:
        - '\.py$'
        - '\.js$'
        - '\.ts$'
        - 'test'

    test-*/:
      description: "Test repositories for validation"
      allow:
        - '^test-.*/.*$'
      deny:
        - (none - test repos are sandboxes)

  global_patterns:
    description: "Patterns that apply across the entire repository"

    deny_everywhere:
      - '__pycache__'
      - '\.pyc$'
      - 'node_modules/'
      - '\.venv/'
      - '\.DS_Store$'
      - 'Thumbs\.db$'
      - '\.env\.local$'
      - '.*\.swp$'

    markdown_files:
      patterns:
        - '\.md$'
      allowed_locations:
        - '^README\.md$'
        - '^\.ai/docs/.*\.md$'
        - '^\.ai/howto/.*\.md$'
        - '^plugins/.*/README\.md$'
        - '^plugins/.*/AGENT_INSTRUCTIONS\.md$'
        - '^plugins/.*/docs/.*\.md$'
        - '^roadmap/.*\.md$'

    yaml_files:
      patterns:
        - '\.yaml$'
        - '\.yml$'
      allowed_locations:
        - '^\.ai/.*\.yaml$'
        - '^plugins/PLUGIN_MANIFEST\.yaml$'
        - '^plugins/.*/templates/.*\.yml$'
        - '^\.pre-commit-config\.yaml$'

enforcement:
  linter_config_key: "layout_rules_file"
  usage_example:
    validation: "Validate file placement against layout.yaml rules"

plugin_specific_rules:
  foundation:
    location: "plugins/foundation/"
    naming: "{plugin-name}/"
    required_files:
      - AGENT_INSTRUCTIONS.md
      - README.md
    structure: "template/ directory for files to copy"

  languages:
    location: "plugins/languages/"
    naming: "{language-name}/"
    required_files:
      - AGENT_INSTRUCTIONS.md
      - README.md
    structure: "linters/, formatters/, testing/, templates/"
    template: "_template/ for creating new language plugins"

  infrastructure:
    location: "plugins/infrastructure/{subcategory}/"
    subcategories:
      - containerization
      - ci-cd
      - iac
    naming: "{tool-name}/"
    required_files:
      - AGENT_INSTRUCTIONS.md
      - README.md
    structure: "templates/ directory"
    template: "_template/ in each subcategory"

  standards:
    location: "plugins/standards/"
    naming: "{standard-name}/"
    required_files:
      - AGENT_INSTRUCTIONS.md
      - README.md
    structure: "docs/ for guidelines, templates/ for configs"
    template: "_template/ for creating new standards plugins"

orchestrator_rules:
  location: "Repository root"
  naming:
    - CREATE-NEW-AI-REPO.md
    - UPGRADE-TO-AI-REPO.md
    - ADD-CAPABILITY.md
  format: "Markdown documents targeting AI agents"
  purpose: "Entry points for users to interact with framework"
